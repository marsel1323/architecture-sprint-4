# Планирование: анализ, идентификация проблем и поиск решений

## Идентификация проблем

### 1. Проблемы производительности

- **Долгая загрузка первой страницы MES**:
  - **Причины**: отсутствие эффективного кеширования, большой объём данных без фильтрации на стороне сервера, отсутствие индексов в БД для ключевых запросов.
  - **Последствия**: снижение производительности операторов, увеличение времени отклика.

- **Медленная работа API расчёта стоимости**:
  - **Причины**: обработка сложных моделей в синхронном режиме, высокий рост нагрузки на единственный инстанс MES.
  - **Последствия**: неудовлетворённость клиентов и партнёров, потеря контрактов.

- **Высокая нагрузка на базу данных**:
  - **Причины**: отсутствие read-replicas, увеличение запросов на запись.
  - **Последствия**: падение скорости выполнения запросов, блокировка операций.

- **Совместное использование БД магазинами и CRM**:
  - **Причины**: общая база данных для разных систем вызывает блокировки при параллельных записях.
  - **Последствия**: снижение производительности и увеличение времени выполнения запросов.

- **Отсутствие метрик производительности**:
  - **Причины**: отсутствие мониторинга и трейсинга для анализа узких мест.
  - **Последствия**: неизвестно, где именно возникает снижение производительности.

---

### 2. Проблемы с заказами

- **Потеря заказов и сообщений в RabbitMQ**:
  - **Причины**: отсутствие мониторинга очередей, потеря сообщений при сбоях.
  - **Последствия**: снижение доверия клиентов, финансовые потери.

- **Зависание заказов в промежуточных статусах**:
  - **Причины**: отсутствие трейсинга, ошибки интеграции между MES и CRM.
  - **Последствия**: невозможность быстро диагностировать проблемы, увеличение жалоб.

- **Отсутствие мониторинга API и интеграций**:
  - **Причины**: недостаточное логирование и отсутствие метрик API.
  - **Последствия**: невозможно определить, на каком этапе теряется заказ клиента.

---

### 3. Проблемы процессов

- **Долгие релизы**:
  - **Причины**: ручное тестирование, отсутствие автоматизации CI/CD.
  - **Последствия**: задержка выхода новых функций, увеличение стоимости релизов.

- **Рост жалоб клиентов**:
  - **Причины**: низкая прозрачность процессов, невозможность клиенту отслеживать статус заказа в реальном времени.
  - **Последствия**: снижение NPS, потеря лояльности.

- **Отсутствие централизованного логирования**:
  - **Причины**: разрозненное логирование между сервисами.
  - **Последствия**: трудности в диагностике проблем, увеличение времени на расследование инцидентов.

---

## Инициативы по устранению проблем

### 1. Производительность

1. **Кеширование запросов первой страницы MES**:
   - Использование Redis для хранения данных дашборда.
   - Уменьшение нагрузки на базу данных.

2. **Оптимизация базы данных**:
   - Добавление read-replicas для распределения нагрузки.
   - Создание индексов для часто запрашиваемых данных.

3. **Асинхронная обработка расчётов API**:
   - Перенос сложных расчётов в отдельные очереди.

4. **Сервис метрик и мониторинга**:
    - Использование Prometheus для сбора метрик производительности API и БД.
    - Настройка алертов на критичные метрики (время отклика, ошибки запросов).

---

### 2. Заказы

5. **Мониторинг RabbitMQ**:
   - Использование Prometheus и Grafana для отслеживания состояния очередей.
   - Настройка алертов на потерю сообщений.

6. **Внедрение распределённого трейсинга**:
   - Использование Jaeger или OpenTelemetry.
   - Отслеживание прохождения заказа через все системы.

---

### 3. Процессы

7. **Автоматизация CI/CD**:
   - Внедрение автотестов с использованием Selenium и JUnit.
   - Настройка автодеплоя для dev/release окружений.

8. **Создание дашборда для клиентов**:
   - Реализация API для получения статуса заказа.
   - Отображение статуса в личном кабинете клиента.

9. **Централизованное логирование**:
   - Внедрение ELK-стека для сбора, обработки и анализа логов.
   - Настройка дашбордов в Kibana для диагностики проблем.

---

## Приоритеты

### **Топ-3 инициативы на полгода**

1. **Мониторинг и трейсинг (RabbitMQ + Jaeger)**:
   - **Причина**: обеспечивает прозрачность и устранение проблем с заказами.
   - **Влияние**: снижение жалоб клиентов на 30%, предотвращение потерь заказов.

2. **Оптимизация базы данных**:
   - **Причина**: решает проблемы производительности.
   - **Влияние**: увеличение скорости отклика API на 50%, уменьшение времени загрузки MES.

3. **Внедрение централизованного логирования и метрик**:
    - **Причина**: позволяет выявить узкие места и ускорить диагностику проблем.
    - **Влияние**: сокращение времени на расследование инцидентов, повышение стабильности.

---

## Целевая архитектура

Через полгода архитектура должна включать:

1. **Мониторинг и трейсинг**:
   - Prometheus и Grafana для метрик.
   - Jaeger/OpenTelemetry для трейсинга заказов.

2. **Производительность**:
   - Redis для кеширования запросов дашборда MES.
   - База данных с read-replicas.

3. **Автоматизация процессов**:
   - CI/CD с автотестами.
   - Интеграция автодеплоя в release и prod.

4. **Централизованное логирование**:
    - ELK-стек для сбора и анализа логов.

---

## Заключение

Реализация предложенных инициатив создаст устойчивую и производительную архитектуру, которая обеспечит:
- Снижение жалоб клиентов на 30-40%.
- Увеличение скорости работы MES и API на 50%.
- Сокращение времени релиза на 40%.

С этой архитектурой компания сможет не только восстановить доверие клиентов, но и успешно масштабироваться в будущем.